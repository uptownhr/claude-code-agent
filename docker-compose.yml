services:
  claude-agent:
    build:
      context: .
      dockerfile: Dockerfile
    image: claude-code-agent:latest
    container_name: claude-agent
    volumes:
      # Mount credentials from host to temporary location
      # The entrypoint script will copy it to the correct location with proper permissions
      - ${HOME}/.claude/.credentials.json:/tmp/host-credentials/.credentials.json:ro
    environment:
      # Disable interactive prompts
      - CI=true
    # Note: Container runs as root initially via entrypoint, then switches to claude user
    # This allows copying credentials from read-only mount with proper permissions

    # Resource limits (optional, uncomment if needed)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '0.5'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.1'
    #       memory: 256M
